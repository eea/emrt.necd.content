<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="emrt.necd.content">

<body>

<metal:main fill-slot="content-core">
  <metal:content-core define-macro="content-core"

      tal:define="toLocalizedTime nocall:here/@@plone/toLocalizedTime">

  <metal:observation define-macro="observation-info"
    tal:define="toLocalizedTime nocall:here/@@plone/toLocalizedTime">
    <div class="backButton">
      <a href=""
        tal:attributes="href here/absolute_url"
        class="standardButton">
            <i class="bi bi-chevron-left"></i>
            Back to observation
      </a>
    </div>
    <div class="esdDiv">
      <div class="row">
        <div class="col-1 d-flex justify-content-center align-items-center">
          <i class="bi bi-file-text-fill fs-1"></i>
        </div>
        <div class="col-11">
          <div class="row">
            <div class="col esdLabel">Ref. Number</div>
          </div>
          <div class="row">
            <div class="col value">
              <span tal:content="context/id">
                UK-WAS-13-001
              </span>
            </div>
          </div>
          <div class="row">
            <div class="col esdLabel">Country</div>
            <div class="col esdLabel">Sector</div>
            <div class="col esdLabel">Pollutants</div>
            <tal:is_inventory condition="python:not view.is_projection()">
              <div class="col esdLabel">Fuel</div>
              <div class="col esdLabel">Inventory year</div>
            </tal:is_inventory>
            <tal:is_projection condition="python:view.is_projection()">
              <div class="col esdLabel">Activity Data Type</div>
              <div class="col esdLabel">Projection year</div>
              <div class="col esdLabel">Reference year</div>
            </tal:is_projection>
          </div>
          <div class="row">
            <div class="col" tal:content="context/country_value">Country</div>
            <div class="col" tal:content="context/ghg_source_sectors_value">Sector</div>
            <div class="col" tal:content="context/pollutants_value">Pollutants</div>
            <tal:is_inventory condition="python:not view.is_projection()">
              <div class="col">
                <span tal:replace="structure python:view.widgets['fuel'].render()"></span>
              </div>
              <div class="col" tal:content="context/year">Year of emission</div>
            </tal:is_inventory>
            <tal:is_projection condition="python:view.is_projection()">
              <div class="col" tal:content="context/activity_data_type"></div>
              <div class="col" tal:content="context/reference_year">Reference year placeholder</div>
              <div class="col">
                <span tal:replace="structure python:', '.join(context.year or [])"></span>
              </div>
            </tal:is_projection>
          </div>
        </div>
      </div>

      <div class="row collapsiblePanelTitle collapsed" data-panel="observation-details" style="margin-top:15px">
        <div class="col">
          <i class="bi bi-chevron-down collapsible-icon icon-collapsed"></i>
          <i class="bi bi-chevron-up collapsible-icon icon-expanded"></i>
          Observation details
        </div>
      </div>
      <div class="row observation-details" style="display:none;padding-top:15px">
        <div class="col esdLabel">Review Year</div>
        <div class="col esdLabel">Parameter</div>
        <div class="col esdLabel">Key category</div>
        <div class="col esdLabel">Last update</div>
      </div>
      <div class="row observation-details" style="display:none">
        <div class="col" tal:content="context/review_year">Year</div>
        <div class="col" tal:content="context/parameter_value">Parameter</div>
        <div class="col">
          <span tal:condition="here/ms_key_category|nothing">
              MS Key category
          </span><br tal:condition="here/ms_key_category|nothing"/>
        </div>
        <div class="col" tal:content="python:context.modified().strftime('%d %b %Y, %H:%M CET')">Last update</div>
      </div>
      <tal:scenario condition="view/is_projection">
        <div class="row observation-details" style="display:none;padding-top:15px">
          <div class="col esdLabel">Scenario Type</div>
        </div>
        <div class="row observation-details" style="display:none;">
          <div class="col" tal:content="context/scenario_type_value">Scenario Type</div>
        </div>
      </tal:scenario>
      <div class="row observation-details" style="display:none;padding-top:15px">
        <div class="col esdLabel">Description flags</div>
      </div>
      <div class="row observation-details" style="display:none">
        <div class="col" tal:content="context/highlight_value">Status flag</div>
      </div>
      <div class="row observation-details" style="display:none;padding-top:15px" tal:condition="view/show_description">
        <div class="col esdLabel">Short description by sector expert</div>
      </div>
      <div class="row observation-details" style="display:none" tal:condition="view/show_description">
        <div class="col">
          <span
            tal:replace="context/text/output|context/text">
              Here goes the description
          </span>
        </div>
      </div>
      <tal:is_projection condition="python:view.is_projection()">
        <tal:nfr2 condition="context/nfr_code_inventory">
          <div class="row observation-details" style="display:none;padding-top:15px">
            <div class="col esdLabel">NFR inventories category code</div>
          </div>
          <div class="row observation-details" style="display:none">
            <div class="col" tal:content="context/nfr_code_inventory">NFR inventories code</div>
          </div>
        </tal:nfr2>
        <div class="row observation-details" style="display:none;padding-top:15px">
            <div class="col esdLabel">Activity Data</div>
          </div>
          <div class="row observation-details" style="display:none">
            <ul tal:repeat="activity context/activity_data_value">
              <li tal:content="activity">Activity Data</li>
            </ul>
          </div>
        </tal:is_projection>
      <div class="row collapsiblePanelTitle collapsed" data-panel="observation-workflow" style="margin-top:15px">
        <div class="col">
          <i class="bi bi-chevron-down collapsible-icon icon-collapsed"></i>
          <i class="bi bi-chevron-up collapsible-icon icon-expanded"></i>
          Observation history
        </div>
      </div>
      <div class="row observation-workflow" style="display:none">
        <div class="col" style="overflow-x:auto">
          <table style="table-layout: fixed" id="workflowTable">
            <tr>
              <tal:item tal:repeat="item context/myHistory">
                <td
                  tal:define="toLocalizedTime nocall:here/@@plone/toLocalizedTime;">
                    <span class="border"></span>
                    <i class="bi bi-circle-fill wfPoint"></i>
                    <br/>
                    <i class="bi bi-person-fill wfRole"></i>
                    <span tal:content="item/role"></span><br/>
                    <a
                      tal:attributes="href python:'http://www.eionet.europa.eu/directory/user?uid='+item['actor']"
                      tal:content="item/author"></a>
                    <br/>
                    <span
                      tal:attributes="class python: ' '.join(['wfStep', item['object']])"><!-- --></span>
                    <span tal:content="item/state"></span><br/>
                    <i class="bi bi-clock wfTime"></i>
                    <span tal:attributes="title python:item['time'].strftime('%d %b %Y, %H:%M CET')" class="datetimeWF">
                      <span tal:replace="item/time"></span>
                    </span><br/>
                </td>
              </tal:item>
            </tr>
          </table>
        </div>
      </div>
    </div>
  </metal:observation>


  <div id="subscription-configuration">
    <h2>Hello <span tal:replace="python:view.user().getProperty('fullname')" /></h2>

    <p>
      Your roles in this particular observation are the following:<br/>
    </p>

      <ul>
        <tal:role repeat="role view/user_roles">
          <li tal:content="role">
            Lead Reviewer
          </li>
        </tal:role>
      </ul>

    <p>
      You are subscribed to receive the following notifications.<br/>
      If you want to subscribe or unsubscribe from receiving those notifications, please check
      the relevant box and then click on save.
    </p>
    <p tal:condition="view/has_local_notifications_settings">
      Or "Clear" your local preferences, so to use the global preferences set on this area
    </p>

    <form method="post" action=""
      tal:attributes="action string:${here/absolute_url}/save-subscriptions">

      <div class="role" tal:repeat="item python:view.my_subscriptions().items()">
        <h3>
          Role: <span tal:replace="python:view.translate_rolename(item[0])" />
        </h3>
        <input type="hidden" name="subscription_data.name:records"
          tal:attributes="value python:item[0]" />

        <table class="listing">
          <thead>
            <tr>
              <th>
                Notification
              </th>
              <th>
                Enabled?
              </th>
            </tr>
          </thead>
          <tbody>
            <tr tal:repeat="notification python:item[1].items()">
              <td>
                <span tal:replace="python:view.notification_name(item[0], notification[0])" />
              </td>
              <td>
                <input type="checkbox"
                  tal:attributes="checked python:notification[1];
                                  name python:'subscription_data.' + notification[0] + ':records';
                  " />
              </td>
            </tr>
          </tbody>

        </table>

      </div>

      <div class="subscription-actions">
        <button type="submit" class="standardButton">
          Save
        </button>

        <a class="standardButton removeButton" href=""
           tal:condition="view/has_local_notifications_settings"
           tal:attributes="href string:${here/absolute_url}/clear-subscriptions">
          Clear
        </a>

      </div>

    </form>

  </div>

  </metal:content-core>
</metal:main>
</body>
</html>
